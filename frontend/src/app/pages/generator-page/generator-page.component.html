<div class="container mx-auto p-4 flex flex-col min-h-[calc(100vh-64px-64px)]">
  <!-- Page Header -->
  <header class="mb-6 flex justify-between items-center">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold mb-2">
        Angular Component Generator
      </h1>
      <p class="text-gray-600">
        Transform UI designs into Angular components with Material Design and
        TailwindCSS
      </p>
    </div>
    <button
      mat-stroked-button
      color="warn"
      (click)="resetUI()"
      [disabled]="isLoading"
      matTooltip="Reset all inputs and results"
    >
      <mat-icon>refresh</mat-icon> Reset
    </button>
  </header>

  <!-- Loading indicator -->
  @if (isLoading) {
  <div class="fixed top-16 left-0 w-full z-50">
    <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
  </div>
  }

  <!-- Error message -->
  @if (error) {
  <div
    class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 flex items-start"
  >
    <mat-icon class="mr-2 text-red-500">error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>
  }

  <!-- Main Layout -->
  <div class="grid grid-cols-1 xl:grid-cols-12 gap-6 flex-grow">
    <!-- Left Panel: Input Options -->
    <div class="col-span-1 xl:col-span-3 flex flex-col gap-6">
      <mat-card class="flex-grow">
        <mat-card-header>
          <mat-card-title>Input</mat-card-title>
          <mat-card-subtitle
            >Upload an image or provide Figma details</mat-card-subtitle
          >
        </mat-card-header>
        <mat-card-content>
          <mat-tab-group class="input-tabs">
            <!-- Image Upload Tab -->
            <mat-tab label="Upload Screenshot">
              <div class="p-4">
                <app-image-uploader
                  (fileSelected)="onImageSelected($event)"
                ></app-image-uploader>
              </div>
            </mat-tab>

            <!-- Figma Input Tab -->
            <mat-tab label="Figma Design">
              <div class="p-4">
                <app-figma-input
                  (figmaSubmitted)="onFigmaSubmitted($event)"
                ></app-figma-input>
              </div>
            </mat-tab>
          </mat-tab-group>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Middle Panel: Preview -->
    <div class="col-span-1 xl:col-span-4 flex flex-col gap-6">
      <div class="preview-container flex-grow">
        <app-preview-pane
          [generatedCode]="generatedCode"
        >
        </app-preview-pane>
      </div>
    </div>

    <!-- Right Panel: Generated Code -->
    <div class="col-span-1 xl:col-span-5 flex flex-col gap-6">
      <mat-card class="flex-grow code-container">
        <mat-card-header>
          <mat-card-title>
            <span>Generated Code</span>
            @if (generatedCode && generatedCode.components.length > 0) {
            <span class="text-sm text-gray-600 ml-2">
              ({{ generatedCode.components[0].componentName }}) @if
              (generatedCode.components.length > 1) { +
              {{ generatedCode.components.length - 1 }} more }
            </span>
            }
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="flex-grow p-0">
          @if (generatedCode) {
          <mat-tab-group class="h-full">
            <mat-tab label="TypeScript">
              <div class="p-2 code-tab-content">
                <div class="flex justify-between items-center mb-2">
                  @if (generatedCode.components.length > 0) {
                  <span class="text-sm"
                    >{{
                      generatedCode.components[0].componentName
                    }}.component.ts</span
                  >
                  }
                  <button
                    mat-icon-button
                    matTooltip="Copy TypeScript code"
                    (click)="copyCode('ts')"
                  >
                    <mat-icon>content_copy</mat-icon>
                  </button>
                </div>
                <app-code-viewer
                  [showSingleEditor]="generatedCode.components.length === 1"
                  [code]="generatedCode.components[0].typescript"
                  [language]="'typescript'"
                  [fileName]="generatedCode.components[0].componentName + '.component.ts'"
                  [generatedCode]="generatedCode"
                >
                </app-code-viewer>
              </div>
            </mat-tab>

            <mat-tab label="HTML">
              <div class="p-2 code-tab-content">
                <div class="flex justify-between items-center mb-2">
                  @if (generatedCode.components.length > 0) {
                  <span class="text-sm"
                    >{{
                      generatedCode.components[0].componentName
                    }}.component.html</span
                  >
                  }
                  <button
                    mat-icon-button
                    matTooltip="Copy HTML code"
                    (click)="copyCode('html')"
                  >
                    <mat-icon>content_copy</mat-icon>
                  </button>
                </div>
                <app-code-viewer
                  [showSingleEditor]="generatedCode.components.length === 1"
                  [code]="generatedCode.components[0].html"
                  [language]="'html'"
                  [fileName]="generatedCode.components[0].componentName + '.component.html'"
                  [generatedCode]="generatedCode"
                >
                </app-code-viewer>
              </div>
            </mat-tab>

            <mat-tab label="SCSS">
              <div class="p-2 code-tab-content">
                <div class="flex justify-between items-center mb-2">
                  @if (generatedCode.components.length > 0) {
                  <span class="text-sm"
                    >{{
                      generatedCode.components[0].componentName
                    }}.component.scss</span
                  >
                  }
                  <button
                    mat-icon-button
                    matTooltip="Copy SCSS code"
                    (click)="copyCode('scss')"
                  >
                    <mat-icon>content_copy</mat-icon>
                  </button>
                </div>
                <app-code-viewer
                  [showSingleEditor]="generatedCode.components.length === 1"
                  [code]="generatedCode.components[0].scss"
                  [language]="'scss'"
                  [fileName]="generatedCode.components[0].componentName + '.component.scss'"
                  [generatedCode]="generatedCode"
                >
                </app-code-viewer>
              </div>
            </mat-tab>
          </mat-tab-group>
          } @else {
          <div
            class="h-full flex flex-col items-center justify-center text-gray-400"
          >
            <mat-icon class="text-8xl mb-4">code</mat-icon>
            <p class="text-center max-w-md">
              Generated Angular code will appear here after you upload an image
              or provide Figma details.
            </p>
          </div>
          }
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

<style>
  .code-tab-content {
    height: calc(100% - 48px);
    display: flex;
    flex-direction: column;
  }
  
  .code-container {
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  .code-container mat-card-content {
    flex: 1;
    overflow: hidden;
  }
  
  /* Make tab group fill available height */
  :host ::ng-deep .mat-mdc-tab-group {
    height: 100%;
  }
  
  :host ::ng-deep .mat-mdc-tab-body-wrapper {
    flex-grow: 1;
  }
  
  :host ::ng-deep .mat-mdc-tab-body.mat-mdc-tab-body-active {
    height: 100%;
  }
  
  :host ::ng-deep .mat-mdc-tab-body-content {
    height: 100%;
  }
  
  .preview-container {
    height: 100%;
    min-height: 400px;
  }
  
  @media (max-width: 1280px) {
    .preview-container {
      min-height: 400px;
    }
  }
</style>
