Okay, let's define a clear project structure for your Angular + FastAPI application, designed to be understandable for implementation, potentially by other developers or AI agents. This structure separates the frontend (Angular) and backend (FastAPI) concerns logically.

```
angular-screenshot-to-code/
├── backend/                  # FastAPI Backend Application
│   ├── app/                  # Core application source code
│   │   ├── __init__.py
│   │   ├── api/              # API Routers/Endpoints
│   │   │   ├── __init__.py
│   │   │   └── v1/           # API Version 1
│   │   │       ├── __init__.py
│   │   │       ├── endpoints/
│   │   │       │   ├── __init__.py
│   │   │       │   ├── generate_image.py  # Endpoint for image -> code
│   │   │       │   └── generate_figma.py  # Endpoint for figma -> code
│   │   │       └── router.py              # Aggregates all v1 endpoints
│   │   │
│   │   ├── core/             # Core components (config, dependencies)
│   │   │   ├── __init__.py
│   │   │   └── config.py     # Application settings (API keys via env vars)
│   │   │
│   │   ├── models/           # Pydantic Models for data validation/serialization
│   │   │   ├── __init__.py
│   │   │   ├── image_input.py # Models for image processing requests
│   │   │   ├── figma_input.py # Models for Figma processing requests
│   │   │   └── generated_code.py # Models for the code generation response
│   │   │
│   │   ├── services/         # Business logic layer
│   │   │   ├── __init__.py
│   │   │   ├── ai_service.py      # Logic for interacting with VLM (OpenAI/Anthropic)
│   │   │   ├── figma_service.py   # Logic for interacting with Figma API
│   │   │   └── code_generator.py # Logic for structuring prompts and processing AI/Figma data into code strings
│   │   │
│   │   ├── utils/            # Utility functions
│   │   │   ├── __init__.py
│   │   │   └── image_processing.py # Image handling utilities (e.g., base64 conversion)
│   │   │
│   │   └── main.py           # FastAPI app creation, middleware, mounting routers
│   │
│   ├── tests/                # Backend tests (Unit, Integration)
│   │   ├── __init__.py
│   │   ├── conftest.py       # Pytest fixtures
│   │   ├── test_api/         # API endpoint tests
│   │   └── test_services/    # Service layer tests
│   │
│   ├── .env.example          # Example environment variables (API keys, etc.)
│   ├── .gitignore
│   ├── Dockerfile            # To containerize the backend (optional but recommended)
│   ├── requirements.txt      # Python dependencies (fastapi, uvicorn, openai, anthropic, python-dotenv, requests, Pillow, etc.)
│   └── README.md             # Backend specific documentation
│
├── frontend/                 # Angular Frontend Application
│   ├── src/                  # Angular source code
│   │   ├── app/              # Core application module and components
│   │   │   ├── components/   # Reusable UI components
│   │   │   │   ├── code-viewer/    # Component to display generated code (using Monaco)
│   │   │   │   │   ├── code-viewer.component.html
│   │   │   │   │   ├── code-viewer.component.scss
│   │   │   │   │   └── code-viewer.component.ts
│   │   │   │   ├── image-uploader/ # Component for handling image uploads
│   │   │   │   │   └── ...
│   │   │   │   ├── figma-input/    # Component for handling Figma input
│   │   │   │   │   └── ...
│   │   │   │   └── preview-pane/   # Component to render the live preview (e.g., in an iframe)
│   │   │   │       └── ...
│   │   │   │
│   │   │   ├── pages/        # Top-level page components (or features)
│   │   │   │   └── generator-page/ # Main page housing the generator UI
│   │   │   │       ├── generator-page.component.html # Layout combining uploader, code viewer, preview
│   │   │   │       ├── generator-page.component.scss
│   │   │   │       └── generator-page.component.ts
│   │   │   │
│   │   │   ├── services/     # Angular services
│   │   │   │   ├── api.service.ts      # Service for making HTTP calls to the backend API
│   │   │   │   └── preview.service.ts  # Service to manage the preview rendering logic
│   │   │   │
│   │   │   ├── models/       # TypeScript interfaces/types for data structures
│   │   │   │   ├── generated-code.model.ts # Interface matching backend's GeneratedCode response
│   │   │   │   └── api-request.model.ts    # Interfaces for API request payloads
│   │   │   │
│   │   │   ├── app.component.html # Main application template (often contains <router-outlet>)
│   │   │   ├── app.component.scss
│   │   │   ├── app.component.ts
│   │   │   ├── app.config.ts      # Standalone App Config (routes, providers)
│   │   │   └── app.routes.ts      # Application routes
│   │   │
│   │   ├── assets/           # Static assets (images, fonts, etc.)
│   │   ├── environments/     # Environment configuration (dev, prod) -> backend API URL
│   │   ├── main.ts           # Main application entry point
│   │   ├── styles.scss       # Global styles, TailwindCSS imports (@tailwind base, components, utilities)
│   │   └── index.html        # Main HTML page
│   │
│   ├── .editorconfig
│   ├── .gitignore
│   ├── angular.json        # Angular CLI workspace configuration
│   ├── package.json        # Node.js dependencies (Angular, Material, Tailwind, Monaco Editor, etc.)
│   ├── package-lock.json
│   ├── postcss.config.js   # PostCSS configuration (for Tailwind)
│   ├── tailwind.config.js  # TailwindCSS configuration
│   ├── tsconfig.app.json   # TypeScript configuration for the app
│   ├── tsconfig.json       # Base TypeScript configuration
│   ├── tsconfig.spec.json  # TypeScript configuration for tests
│   └── README.md           # Frontend specific documentation
│
└── README.md                 # Main project README
```

**Explanation for AI Agents & Developers:**

1.  **Root Directory (`angular-screenshot-to-code/`):**
    *   Contains the `backend/` and `frontend/` subdirectories.
    *   The main `README.md` provides an overview of the entire project, setup instructions for both frontend and backend, and how to run them together.

2.  **Backend Directory (`backend/`):**
    *   **Technology:** Python with FastAPI.
    *   **Entry Point:** `app/main.py`. This file initializes the FastAPI application, includes CORS middleware (essential for communication with the frontend running on a different port/domain), and mounts the API routers defined in `app/api/v1/router.py`.
    *   **API Endpoints (`app/api/v1/endpoints/`):** Contains the core logic for handling HTTP requests.
        *   `generate_image.py`: Handles POST requests with image data. It will likely receive the image file, use `services/ai_service.py` and `services/code_generator.py` to get the code, and return it.
        *   `generate_figma.py`: Handles POST requests with Figma URL/token. It will use `services/figma_service.py` and `services/code_generator.py` to get the code and return it.
    *   **Services (`app/services/`):** Contains the primary business logic, decoupled from the API layer.
        *   `ai_service.py`: Responsible *only* for communicating with the external VLM API (sending prompts/images, receiving responses). Takes pre-formatted prompts and image data.
        *   `figma_service.py`: Responsible *only* for communicating with the Figma API (fetching file data).
        *   `code_generator.py`: This is crucial. It takes input (image description/analysis from AI service, or structured Figma data from Figma service) and contains the logic/prompting strategy to format the final Angular component code (`.ts`, `.html`, `.scss`) using Angular Material and Tailwind. It orchestrates calls to the AI service if needed for image processing.
    *   **Models (`app/models/`):** Pydantic models define the expected structure of request bodies and response bodies, ensuring data validation.
    *   **Core (`app/core/`):** Handles configuration loading, especially sensitive data like API keys from environment variables (`config.py`).
    *   **Dependencies:** Defined in `requirements.txt`. Install using `pip install -r requirements.txt`.
    *   **Environment Variables:** API keys (OpenAI, Anthropic, Figma) *must* be stored in environment variables, not hardcoded. `.env.example` shows which variables are needed. Use a library like `python-dotenv` for local development.
    *   **Running:** Typically run using `uvicorn app.main:app --reload` during development.

3.  **Frontend Directory (`frontend/`):**
    *   **Technology:** Angular (using Standalone Components pattern recommended).
    *   **Entry Point:** `src/main.ts`. Bootstraps the Angular application.
    *   **Configuration:** `angular.json` (build/serve), `tailwind.config.js`, `postcss.config.js`, `src/styles.scss` (Tailwind/global styles).
    *   **Core Component:** `src/app/app.component.ts` (root component), configured in `src/app/app.config.ts`.
    *   **Routing:** Defined in `src/app/app.routes.ts`. Likely points to `GeneratorPageComponent`.
    *   **Main UI (`src/app/pages/generator-page/`):** This component orchestrates the user interface, containing the upload/input components, the code display areas, and the preview area. It interacts with the `ApiService`.
    *   **Reusable Components (`src/app/components/`):** Encapsulate specific UI elements like the image uploader, the Monaco-based code viewers, and the preview pane (which might render content in an `iframe` using `srcdoc`).
    *   **API Communication (`src/app/services/api.service.ts`):** Contains methods (e.g., `generateCodeFromImage(file: File)`, `generateCodeFromFigma(url: string)`) that use Angular's `HttpClient` to send requests to the FastAPI backend endpoints. It fetches the backend URL from `src/environments/`.
    *   **Preview Logic (`src/app/services/preview.service.ts`):** May handle the logic for taking the generated HTML/CSS strings and safely rendering them in the `PreviewPaneComponent`.
    *   **Models (`src/app/models/`):** TypeScript interfaces that define the structure of data exchanged with the backend API (should match backend Pydantic models).
    *   **Dependencies:** Defined in `package.json`. Install using `npm install`.
    *   **Running:** Typically run using `ng serve` during development.

4.  **Development Workflow:**
    *   Run the backend server (e.g., `cd backend && uvicorn app.main:app --reload`).
    *   Run the frontend server (e.g., `cd frontend && ng serve`).
    *   Ensure the frontend's environment configuration points to the correct backend URL (e.g., `http://localhost:8000`).
    *   Ensure the backend has CORS configured correctly to allow requests from the frontend's origin (e.g., `http://localhost:4200`).

This structure provides a solid foundation, separating concerns and using standard conventions for both FastAPI and Angular development.